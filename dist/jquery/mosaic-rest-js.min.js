!function(t){function e(){var t,e,i=arguments;for(t=1;t<i.length;t++)for(e in i[t])i[0][e]=i[t][e];return i[0]}function i(t){this.config=e({host:"localhost",port:"7777",context:"portalserver",username:"admin",password:"admin",portal:null},t||{})}function r(t,e,i){this.command=t,this.config=e,this.uri=i,this.qs={},this.headers={"Content-Type":"application/xml"}}e(i.prototype,{server:function(){return new r("server",this.config,["portals"])},portal:function(){var t=["portals",this.config.portal];return new r("portal",this.config,t)},catalog:function(t){var e=[],i="server";return"boolean"==typeof t?(e=["portals",this.config.portal],i="portal"):(e=["server"],t&&e.push(t)),new r(i,this.config,e)},container:function(t){var e=["portals",this.config.portal,"containers"];return t&&e.push(t),new r("container",this.config,e)},widget:function(t){var e=["portals",this.config.portal,"widgets"];return t&&e.push(t),new r("widget",this.config,e)},page:function(t){var e=["portals",this.config.portal,"pages"];return t&&e.push(t),new r("page",this.config,e)},link:function(t){var e=["portals",this.config.portal,"links"];return t&&e.push(t),new r("link",this.config,e)},user:function(t,e,i){var n=["users"];return t&&n.push(t),e&&n.push("groups"),i&&n.push(i),new r("user",this.config,n)},group:function(t,e){var i=["groups"];return t&&i.push(t),e&&i.push("users"),new r("group",this.config,i)},template:function(t){var e=["templates"];return t&&e.push(t),new r("template",this.config,e)},audit:function(t){return new r("audit",this.config,[t?"auditmeta":"auditevents"])},cache:function(t){var e=["caches",t];return new r("cache",this.config,e)},"import":function(){},"export":function(){}}),e(r.prototype,{rights:function(){return this.uri.push("rights"),this},tag:function(t){return this.uri.push("tags"),t&&this.uri.push(t),this},query:function(t){return this.qs=t,this},get:function(){return"portals"===this.uri[0]&&2===this.uri.length&&(this.uri[1]+=".xml"),this.method="GET",this.req()},post:function(t,e){return this.method="POST",this.parseInput(t,e)},put:function(t,e){return this.method="PUT",this.parseInput(t,e)},"delete":function(t,e){if(this.method="DELETE",t)switch(this.method="POST",this.command){case"server":this.uri=["delete","catalog"];break;case"portal":this.uri[2]="delete",this.uri[3]="catalog";break;case"link":this.uri[2]="delete",this.uri[3]="links"}return"cache"===this.command&&"all"===this.uri[1]?this.deleteAllCache(0):this.parseInput(t,e)},deleteAllCache:function(t){var e=this;return this.uri[1]=o[t],this.req().then(function(i){return!i.error&&t<o.length-1?e.deleteAllCache(++t):i})}});var n,o=["globalModelCache","retrievedWidgetCache","widgetChromeStaticCache","serverSideClosureCache","urlLevelCache","gModelCache","uuidFromExtendedItemNamesCache","springAclSidCacheRegion","contextNameToItemNameToUuidCache","widgetCache","uuidToContentReferencesCache","springAclCacheRegion","itemUuidToReferencingLinkUuidsCache","uuidToCacheKeysCache","versionBundleCache"];"function"==typeof define&&define.amd?define(["jquery"],function(t){return n=t,i}):(n=jQuery,t.BBRest=i),r.prototype.req=function(t){var e=this,i="http://"+this.config.host+":"+this.config.port+"/"+this.config.context+"/"+this.uri.join("/"),r=n.param(this.qs);return r&&(i+="?"+r),this.headers.Authorization="Basic "+btoa(this.config.username+":"+this.config.password),n.ajax({type:this.method,url:i,dataType:"xml",headers:this.headers,data:t||""}).then(function(r,n,o){var s={statusCode:parseInt(o.status),info:o.statusCode,body:o.responseText,href:i,method:e.method,reqBody:t};return s.statusCode>=400&&(s.error=!0),s}).fail(function(){return{error:!0,statusCode:null,info:"Request failed",body:null,href:i,method:e.method,reqBody:t,file:e.file||null}})},r.prototype.parseInput=function(t,e){var i=this;switch(typeof t){case"string":return n.ajax({type:"GET",dataType:"text",url:t}).then(function(t){return i.req(t)}).fail(function(){return{error:!0,info:"Wrong URL"}});case"function":return t.apply(i,e);default:return this.req()}}}(this);