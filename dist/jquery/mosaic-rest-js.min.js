!function(t){function e(){var t,e,i=arguments;for(t=1;t<i.length;t++)for(e in i[t])i[0][e]=i[t][e];return i[0]}function i(t){this.config=e({host:"localhost",port:"7777",context:"portalserver",username:"admin",password:"admin",plugin:null,portal:null},t||{})}function r(t,i,r){this.command=t,this.config=e({},i),this.uri=r,this.qs={},this.headers={"Content-Type":"application/xml"}}e(i.prototype,{server:function(){return new r("server",this.config,["portals"])},portal:function(){var t=["portals",this.config.portal];return new r("portal",this.config,t)},catalog:function(t){var e=["catalog"];return t&&e.push(t),new r("server",this.config,e)},portalCatalog:function(t){var e=["portals",this.config.portal,"catalog"];return t&&e.push(t),new r("portal",this.config,e)},container:function(t){var e=["portals",this.config.portal,"containers"];return t&&e.push(t),new r("container",this.config,e)},widget:function(t){var e=["portals",this.config.portal,"widgets"];return t&&e.push(t),new r("widget",this.config,e)},page:function(t){var e=["portals",this.config.portal,"pages"];return t&&e.push(t),new r("page",this.config,e)},link:function(t){var e=["portals",this.config.portal,"links"];return t&&e.push(t),new r("link",this.config,e)},user:function(t,e,i){var n=["users"];return t&&n.push(t),e&&n.push("groups"),i&&n.push(i),new r("user",this.config,n)},group:function(t,e,i){var n=["groups"];return t&&n.push(t),e&&n.push("users"),i&&n.push(i),new r("group",this.config,n)},template:function(t){var e=["templates"];return t&&e.push(t),new r("template",this.config,e)},audit:function(t){return new r("audit",this.config,[t?"auditmeta":"auditevents"])},cache:function(t){var e=["caches",t];return new r("cache",this.config,e)},"import":function(){},"export":function(){}}),e(r.prototype,{rights:function(){return this.uri.push("rights"),this},tag:function(t,e){return this.uri.push("tags"),t&&this.uri.push(t),e&&(this.qs.type=e),this},query:function(t){return this.qs=t,this},get:function(){return"portals"===this.uri[0]&&2===this.uri.length&&(this.uri[1]+=".xml"),"pages"===this.uri[2]&&this.uri[3]&&(this.uri[3]+=".xml"),"containers"===this.uri[2]&&this.uri[3]&&(this.uri[3]+=".xml"),"widgets"===this.uri[2]&&this.uri[3]&&(this.uri[3]+=".xml"),"links"===this.uri[2]&&this.uri[3]&&(this.uri[3]+=".xml"),this.method="GET",this.req()},post:function(t,e){return this.method="POST",this.parseInput(t,e)},put:function(t,e){return this.method="PUT",this.parseInput(t,e)},"delete":function(t,e){if(this.method="DELETE",t)switch(this.method="POST",this.command){case"server":this.uri=["delete","catalog"];break;case"portal":this.uri[2]="delete",this.uri[3]="catalog";break;case"link":this.uri[2]="delete",this.uri[3]="links"}return"cache"===this.command&&"all"===this.uri[1]?this.deleteAllCache(0):this.parseInput(t,e)},deleteAllCache:function(t){var e=this;return this.uri[1]=s[t],this.req().then(function(i){return!i.error&&t<s.length-1?e.deleteAllCache(++t):i})}});var n,s=["globalModelCache","retrievedWidgetCache","widgetChromeStaticCache","serverSideClosureCache","urlLevelCache","gModelCache","uuidFromExtendedItemNamesCache","springAclSidCacheRegion","contextNameToItemNameToUuidCache","widgetCache","uuidToContentReferencesCache","springAclCacheRegion","itemUuidToReferencingLinkUuidsCache","uuidToCacheKeysCache","versionBundleCache"];"function"==typeof define&&define.amd?define(["jquery"],function(t){return n=t,i}):(n=jQuery,t.BBRest=i),r.prototype.req=function(t){var e=this,i="http://"+this.config.host+":"+this.config.port+"/"+this.config.context+"/"+this.uri.join("/"),r=n.param(this.qs);return r&&(i+="?"+r),this.headers.Authorization="Basic "+btoa(this.config.username+":"+this.config.password),n.ajax({type:this.method,url:i,dataType:"xml",headers:this.headers,data:t||""}).then(function(r,n,s){var o={statusCode:parseInt(s.status),statusInfo:s.statusCode,body:s.responseText,href:i,method:e.method,reqBody:t};if(o.statusCode>=400)o.error=!0;else if(302===o.statusCode){var u=o.headers.location.indexOf("errorMessage=");-1!==u&&(o.error=unescape(o.headers.location.substr(u+13)))}else e.config.plugin&&o.body&&(o.body=e.config.plugin(o.body));var u=o.href.indexOf("errorMessage=");return-1!==u&&(o.error=unescape(o.href.substr(u+13))),o}).fail(function(){return{error:!0,statusCode:null,ststusInfo:"Request failed",body:null,href:i,method:e.method,reqBody:t,file:e.file||null}})},r.prototype.parseInput=function(t){var e=this;switch(typeof t){case"string":return n.ajax({type:"GET",dataType:"text",url:t}).then(function(t){return e.req(t)}).fail(function(){return{error:!0,info:"Wrong URL"}});case"object":return this.req(this.config.plugin.apply(this,arguments));default:return this.req()}}}(this);